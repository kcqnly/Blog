<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Golang入门笔记 | kcqnly的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="记录学习过程，分享生活琐碎。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.073f7cf6.css" as="style"><link rel="preload" href="/assets/js/app.48ae9a92.js" as="script"><link rel="preload" href="/assets/js/3.4643d9f1.js" as="script"><link rel="preload" href="/assets/js/1.edbbee7e.js" as="script"><link rel="preload" href="/assets/js/15.2267be98.js" as="script"><link rel="prefetch" href="/assets/js/10.c8c6f4d9.js"><link rel="prefetch" href="/assets/js/11.a5ebca7d.js"><link rel="prefetch" href="/assets/js/12.0b8019c4.js"><link rel="prefetch" href="/assets/js/13.73ad9272.js"><link rel="prefetch" href="/assets/js/14.c220dffe.js"><link rel="prefetch" href="/assets/js/16.1e6ca1bf.js"><link rel="prefetch" href="/assets/js/17.2552cadb.js"><link rel="prefetch" href="/assets/js/18.9cd2c69c.js"><link rel="prefetch" href="/assets/js/19.44831c8d.js"><link rel="prefetch" href="/assets/js/20.2129a481.js"><link rel="prefetch" href="/assets/js/21.c8632750.js"><link rel="prefetch" href="/assets/js/22.796b3f55.js"><link rel="prefetch" href="/assets/js/23.c662b874.js"><link rel="prefetch" href="/assets/js/24.ecfb091a.js"><link rel="prefetch" href="/assets/js/25.60e0a946.js"><link rel="prefetch" href="/assets/js/26.f75f68f2.js"><link rel="prefetch" href="/assets/js/27.e712e931.js"><link rel="prefetch" href="/assets/js/28.5cb9ac6a.js"><link rel="prefetch" href="/assets/js/29.1827cad6.js"><link rel="prefetch" href="/assets/js/30.7c3f13a0.js"><link rel="prefetch" href="/assets/js/4.e4e137b0.js"><link rel="prefetch" href="/assets/js/5.7566384d.js"><link rel="prefetch" href="/assets/js/6.0afd6c0c.js"><link rel="prefetch" href="/assets/js/7.285f0b9b.js"><link rel="prefetch" href="/assets/js/8.0086b5f0.js"><link rel="prefetch" href="/assets/js/9.384c1a1d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.073f7cf6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>kcqnly的博客</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>记录学习过程，分享生活琐碎。</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>kcqnly</span>
            
          <span data-v-4e82dffc>2019 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="kcqnly的博客" class="logo"> <span class="site-name">kcqnly的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/客户端/" class="nav-link"><i class="undefined"></i>
  客户端
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/others/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  About
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    kcqnly
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>19</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>10</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/客户端/" class="nav-link"><i class="undefined"></i>
  客户端
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/others/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  About
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Golang入门笔记</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>kcqnly</span>
            
          <span data-v-4e82dffc>2019 - </span>
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Golang入门笔记</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>kcqnly</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2021/6/5</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>Go</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="设置代理"><a href="#设置代理" class="header-anchor">#</a> 设置代理</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>go <span class="token function">env</span> -w <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on
go <span class="token function">env</span> -w <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="分支和循环"><a href="#分支和循环" class="header-anchor">#</a> 分支和循环</h2> <p>猜数字demo</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> count <span class="token operator">=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token keyword">var</span> init <span class="token operator">=</span> <span class="token number">50</span>
	<span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token keyword">var</span> max <span class="token operator">=</span> <span class="token number">100</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> init <span class="token operator">&lt;</span> count <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 太小了\n&quot;</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
			min <span class="token operator">=</span> init
			init <span class="token operator">+=</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> init<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> init <span class="token operator">&gt;</span> count <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 太大了\n&quot;</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
			max <span class="token operator">=</span> init
			init <span class="token operator">-=</span> <span class="token punctuation">(</span>init <span class="token operator">-</span> min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 猜对了\n&quot;</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="实数"><a href="#实数" class="header-anchor">#</a> 实数</h2> <div class="language-go line-numbers-mode"><pre class="language-go"><code>days <span class="token operator">:=</span> <span class="token number">365.2425</span>
<span class="token keyword">var</span> days <span class="token operator">=</span> <span class="token number">365.2425</span>
<span class="token keyword">var</span> days <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">365.2425</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>只要数字含有小数部分，那么它的类型默认就是<code>float64</code></li> <li>如果你使用一个整数来初始化某个变量，那么你必须指定它的类型为 float64，否则它就是一个整数类型</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> answer <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Go 语言里有两种浮点数类型：</p> <ul><li><p>默认是 float64</p> <ul><li><p>64 位的浮点类型</p></li> <li><p>占用 8 字节内存</p></li> <li><p>某些编程语言把这种类型叫做 double（双精度）</p></li></ul></li> <li><p>float32</p> <ul><li>占用 4 字节内存</li> <li>精度比 float64 低</li> <li>有时叫做单精度类型</li> <li>想要使用单精度类型，你必须在声明变量的时候指定该类型</li></ul></li></ul> <p>浮点数精度问题：为了尽量最小化舍入错误，建议先做乘法，再做除法</p> <h2 id="整数"><a href="#整数" class="header-anchor">#</a> 整数</h2> <ul><li>所有的整数类型都有一个取值范围，超出这个范围，就会发生“环绕”</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> read <span class="token builtin">uint8</span> <span class="token operator">=</span> <span class="token number">255</span>
red<span class="token operator">++</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span>

<span class="token keyword">var</span> number <span class="token builtin">int8</span> <span class="token operator">=</span> <span class="token number">127</span>
number<span class="token operator">++</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>使用 %b 格式化动词</li></ul> <p>打印每个bit</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> green <span class="token builtin">uint8</span> <span class="token operator">=</span> <span class="token number">3</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span>
green<span class="token operator">++</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="big包"><a href="#big包" class="header-anchor">#</a> big包</h2> <ul><li><p>对于较大的整数（超过1018 ）：big.Int</p></li> <li><p>对于任意精度的浮点类型，big.Float</p></li> <li><p>对于分数，big.Rat</p></li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>distance <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Int<span class="token punctuation">)</span>
<span class="token comment">// 10表示十进制</span>
distance<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span><span class="token string">&quot;240000000000000000000&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="较大值的常量"><a href="#较大值的常量" class="header-anchor">#</a> 较大值的常量</h3> <p>在Go里面，常量可以是无类型的的（untyped）</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">const</span> distance <span class="token operator">=</span> <span class="token number">24000000000000000000000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>常量使用 const 关键字来声明，程序里的每个字面值都是常量。</p></li> <li><p>这意味着：比较大的数值可以直接使用（作为字面值）</p></li> <li><p>针对字面值和常量的计算是在编译阶段完成的。</p></li> <li><p>Go 的编译器是用 Go 编写的，这种无类型的数值字面值就是由 big 包所支持的。这使你可以操作很大的数（超过18的10¹⁸）</p></li> <li><p>只要能够容纳得下，那么常量就可以赋值给变量。</p></li> <li><p>常量和big.Int的值是不能互换的</p></li></ul> <h2 id="字符和字符串"><a href="#字符和字符串" class="header-anchor">#</a> 字符和字符串</h2> <h3 id="rune"><a href="#rune" class="header-anchor">#</a> rune</h3> <p>rune的使用，需要在输出的时候指明是字符型，不然会输出数字。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> frog <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token number">0x1f438</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> frog<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>因为<code>rune</code>是<code>int32</code>的别名，定义别名的代码如下：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token builtin">uint8</span>
<span class="token keyword">type</span> <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token builtin">int32</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="字符"><a href="#字符" class="header-anchor">#</a> 字符</h3> <ul><li><p>字符字面值使用 ‘’ 括起来。例如：’A’</p></li> <li><p>如果没指定字符类型的话，那么 Go 会推断它的类型为 rune</p></li> <li><p>字符字面值也可以用 byte 类型</p></li></ul> <h3 id="字符串"><a href="#字符串" class="header-anchor">#</a> 字符串</h3> <ul><li>可一个给某个变量赋予不同的 string 值，但是 string 本身是不可变的</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>message <span class="token operator">:=</span> <span class="token string">&quot;shalom&quot;</span>
c <span class="token operator">:=</span> message<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>len 是 Go 语言的一个内置函数</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它返回的是字符串具有的byte数，在对中文等语言字符串计算时是不准确的。可以使用 utf-8 包，它提供可以按 rune 计算字符串长度的方法。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;unicode/utf8&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	question <span class="token operator">:=</span> <span class="token string">&quot;¿Cómo estás?&quot;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;bytes&quot;</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">RuneCountInString</span><span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; runes&quot;</span><span class="token punctuation">)</span>
	c<span class="token punctuation">,</span> size <span class="token operator">:=</span> utf8<span class="token punctuation">.</span><span class="token function">DecodeRuneInString</span><span class="token punctuation">(</span>question<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;First rune:%c %v bytes&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>使用range关键词，遍历集合</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>question <span class="token operator">:=</span> <span class="token string">&quot;¿Cómo estás?&quot;</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token operator">:=</span> <span class="token keyword">range</span> question <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v %c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="类型转换"><a href="#类型转换" class="header-anchor">#</a> 类型转换</h2> <p>整型转字符串</p> <ul><li>使用strconv包中的<code>Itoa</code>函数可以解决。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>countdown <span class="token operator">:=</span> <span class="token number">10</span>
str <span class="token operator">:=</span> <span class="token string">&quot;Launch in &quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>countdown<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; seconds.&quot;</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>Sprintf函数</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>countdown <span class="token operator">:=</span> <span class="token number">10</span>
str <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Launch in %v seconds.&quot;</span><span class="token punctuation">,</span> countdown<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>字符串转数字</p> <p>可以使用strconv里的<code>Atoi</code>函数，由于字符串中可能包含任意字符，或者要转换的数字太大，Atoi函数可能会报错。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>countdown<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>countdown<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <ul><li>在 Go 里，大写字母开头的函数、变量或其它标识符都会被导出，对其它包可用。小写字母开头的就不行。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">kelvinToCelsius</span><span class="token punctuation">(</span>k <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
	k <span class="token operator">-=</span> <span class="token number">273.15</span>
	<span class="token keyword">return</span> k
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	kelvin <span class="token operator">:=</span> <span class="token number">294.0</span>
	celsius <span class="token operator">:=</span> <span class="token function">kelvinToCelsius</span><span class="token punctuation">(</span>kelvin<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>kelvin<span class="token punctuation">,</span> <span class="token string">&quot; =====&gt; &quot;</span><span class="token punctuation">,</span> celsius<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h2> <ul><li>关键字 type 可以用来声明新类型：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> celsius <span class="token builtin">float64</span>
<span class="token keyword">var</span> temperature celsius <span class="token operator">=</span> <span class="token number">20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>不同类型不能混用，即使底层类型一样也不能混用</li></ul> <p>通过方法添加行为</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> kelvin <span class="token builtin">float64</span>
<span class="token keyword">type</span> celsius <span class="token builtin">float64</span>

<span class="token comment">//关键词 接收者   方法名   返回值类型</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>k kelvin<span class="token punctuation">)</span> <span class="token function">celsius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> celsius <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">celsius</span><span class="token punctuation">(</span>k <span class="token operator">-</span> <span class="token number">273.15</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> kelvin kelvin <span class="token operator">=</span> <span class="token number">294.0</span>
	celsius <span class="token operator">:=</span> kelvin<span class="token punctuation">.</span><span class="token function">celsius</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>kelvin<span class="token punctuation">,</span> <span class="token string">&quot; =====&gt; &quot;</span><span class="token punctuation">,</span> celsius<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>可以将方法和同包中的任何类型相关联，但不可以是int、float64等预声明的类型进行关联。</li></ul> <h2 id="一等函数"><a href="#一等函数" class="header-anchor">#</a> 一等函数</h2> <ul><li>将函数本身赋值给变量</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> kelvin <span class="token builtin">float64</span>

<span class="token keyword">func</span> <span class="token function">fackSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> kelvin <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">kelvin</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">realSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> kelvin <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	sensor <span class="token operator">:=</span> fackSensor
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">sensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	sensor <span class="token operator">=</span> realSensor
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">sensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>将函数赋值给其他函数</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> kelvin <span class="token builtin">float64</span>

<span class="token keyword">func</span> <span class="token function">fackSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> kelvin <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">kelvin</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">measureTemperature</span><span class="token punctuation">(</span>samples <span class="token builtin">int</span><span class="token punctuation">,</span> sensor <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> kelvin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> samples<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		k <span class="token operator">:=</span> <span class="token function">sensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v Kn\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">measureTemperature</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> fackSensor<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="闭包和匿名函数"><a href="#闭包和匿名函数" class="header-anchor">#</a> 闭包和匿名函数</h3> <ul><li>匿名函数就是没有名字的函数，在Go里面也称作函数字面值。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;f()&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	test <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;test()&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;====&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>因为函数字面值需要保留外部作用域的变量引用，所以函数字面值都是闭包的。</li> <li>闭包（closure）就是由于匿名函数封闭并包围作用域中的变量而得名的。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">type</span> measure <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>

<span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>message <span class="token builtin">string</span><span class="token punctuation">)</span> measure <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;I get &quot;</span> <span class="token operator">+</span> message
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	f <span class="token operator">:=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="数组"><a href="#数组" class="header-anchor">#</a> 数组</h2> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> planets <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">string</span>
planets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Mars&quot;</span>
planets<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Venus&quot;</span>
planets<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Earth&quot;</span>
earth <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span><span class="token punctuation">)</span> 	<span class="token comment">// 获取数组长度</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用复合字面值初始化数组</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以在复合字面值中使用<code>...</code>作为数组的长度，这样go编译器会为你算出数组的元素数量。</p> <h3 id="数组复制"><a href="#数组复制" class="header-anchor">#</a> 数组复制</h3> <ul><li><p>无论数组赋值给新的变量还是将它传递给函数，都会产生一个完整的数组副本。</p></li> <li><p>数组也是一种值，函数通过值传递来接受参数。所以数组作为函数的参数就非常低效。</p></li> <li><p>数组的长度也是数组类型的一部分。</p></li> <li><p>尝试将长度不符的数组作为参数传递，将会报错。</p></li> <li><p>函数一般使用 slice 而不是数组作为参数</p></li></ul> <h2 id="切片"><a href="#切片" class="header-anchor">#</a> 切片</h2> <p>切片的是半开区间</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>
test <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>忽略掉 slice 的起始索引，表示从数组的起始位置进行切分；</p></li> <li><p>忽略掉 slice 的结束索引，相当于使用数组的长度作为结束索引。</p></li> <li><p>注意：slice 的索引不能是负数。</p></li> <li><p>如果同时省略掉起始和结束索引，那就是包含数组所有元素的一个 slice。</p></li> <li><p>切分数组的语法也可以用于切分字符串，不过索引代表的是字节数而非 rune 的数。</p></li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>
<span class="token comment">// 创建slice方式一</span>
planetSlice <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment">// 方式二</span>
planetsTemp <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planetSlice<span class="token punctuation">,</span> planetsTemp<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Go 里面很多函数都倾向于使用 slice 而不是数组作为参数。可以将 slice 或数组作为底层类型，然后绑定其它方法。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>
<span class="token comment">// 转换成IntSlice类型，再调用sort方法</span>
sort<span class="token punctuation">.</span><span class="token function">IntSlice</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用<code>append</code>函数将数据添加到切片中。append函数可以添加多个参数。如果底层数组的容量不够，将会再分配一个数组，slice总容量增加一倍。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span>
dwarfs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">,</span> <span class="token string">&quot;Orcus&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">)</span>
dwarfs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">,</span> <span class="token string">&quot;Salacia&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Quaoar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sedna&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>使用<code>len</code>函数获取切片的长度。切片容量是指slice底层数组的容量，可以使用<code>cap</code>函数获取。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">dump</span><span class="token punctuation">(</span>label <span class="token builtin">string</span><span class="token punctuation">,</span> slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: length %v, capacity %v %v\n&quot;</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> slice<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>三索引切分操作，用于限制新建切片的容量。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>terrestrial <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用<code>make</code>函数对slice进行预分配。</p> <ul><li><p>当 slice 的容量不足以执行 append 操作时，Go 必须创建新数组并复制旧数组中的内容。</p></li> <li><p>但通过内置的 make 函数，可以对 slice 进行预分配策略。尽量避免额外的内存分配和数组复制操作。</p></li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>dwarfs <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 第二个和第三个参数分别是长度和容量</span>
temp <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 表示长度和容量都是10</span>
dwarfs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">,</span> <span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>声明可变参数的函数，通过在类型前添加<code>...</code>，表示为可变参数</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// words类型为切片</span>
<span class="token keyword">func</span> <span class="token function">terraform</span><span class="token punctuation">(</span>prefix <span class="token builtin">string</span><span class="token punctuation">,</span> worlds <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
	newWorlds <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>worlds<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> worlds <span class="token punctuation">{</span>
		newWorlds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> prefix <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> worlds<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> newWorlds
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="map"><a href="#map" class="header-anchor">#</a> map</h2> <p>map 是 Go 提供的另外一种集合：</p> <ul><li><p>它可以将 key 映射到 value。</p></li> <li><p>可快速通过 key 找到对应的 value</p></li> <li><p>它的 key 几乎可以是任何类型</p></li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// map[keyType]valueType</span>
temperature <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span>
		<span class="token string">&quot;Earth&quot;</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
		<span class="token string">&quot;Mars&quot;</span><span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取value</span>
temp <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;On average the Earth is %vº C.\n&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span>
<span class="token comment">// 修改value的值</span>
temperature<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">16</span>
<span class="token comment">// 添加新的键值对</span>
temperature<span class="token punctuation">[</span><span class="token string">&quot;Venus&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">464</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span>
<span class="token comment">// 货物不存在的key对应的value，会返回相应类型的0值</span>
moon <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Moon&quot;</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>moon<span class="token punctuation">)</span>
<span class="token comment">// 通过逗号ok写法来判断是否存在相应的key</span>
<span class="token keyword">if</span> moon<span class="token punctuation">,</span> ok <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Moon&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;On average the moon is %vº C.\n&quot;</span><span class="token punctuation">,</span> moon<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Where is the moon?&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 判断是否存在Earth这个key</span>
<span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span>
<span class="token comment">// 删除相应的key</span>
<span class="token function">delete</span><span class="token punctuation">(</span>temperature<span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li>数组、int、float64等类型在赋值给新变量或传递至函数/方法的时候会创建相应的副本，但 map 不会</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>planets <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
	<span class="token string">&quot;Earth&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Sector ZZ9&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;Mars&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;Sector ZZ9&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

planetsMarkII <span class="token operator">:=</span> planets
planets<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;whoops&quot;</span>
<span class="token comment">// 输出结果一致</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planetsMarkII<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="使用-make-函数对-map-进行预分配"><a href="#使用-make-函数对-map-进行预分配" class="header-anchor">#</a> 使用 make 函数对 map 进行预分配</h3> <ul><li><p>除非你使用复合字面值来初始化 map，否则必须使用内置的<code>make</code>函数来为 map 分配空间。</p></li> <li><p>创建 map 时，<code>make</code> 函数可接受一个或两个参数</p></li> <li><p>第二个参数用于为指定数量的 key 预先分配空间</p></li> <li><p>使用<code>make</code>函数创建的 map 的初始长度为 0</p></li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// 使用复合字面值进行初始化</span>
temperatures <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span>
	<span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33.0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用make函数进行初始化</span>
frequency <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment">// 使用map进行计数</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> temperatures <span class="token punctuation">{</span>
	frequency<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">++</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用range进行遍历map时，顺序无法保证</span>
<span class="token keyword">for</span> t<span class="token punctuation">,</span> num <span class="token operator">:=</span> <span class="token keyword">range</span> frequency <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+.2f occurs %d times\n&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="使用-map-和-slice-实现数据分组"><a href="#使用-map-和-slice-实现数据分组" class="header-anchor">#</a> 使用 map 和 slice 实现数据分组</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	temperatures <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span>
		<span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33.0</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	groups <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> temperatures <span class="token punctuation">{</span>
        <span class="token comment">// 跨度为10</span>
		g <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Trunc</span><span class="token punctuation">(</span>t<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span>
        <span class="token comment">// 向slice中添加值</span>
		groups<span class="token punctuation">[</span>g<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>groups<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> g<span class="token punctuation">,</span> temperatures <span class="token operator">:=</span> <span class="token keyword">range</span> groups <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: %v\n&quot;</span><span class="token punctuation">,</span> g<span class="token punctuation">,</span> temperatures<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="将-map-用作-set"><a href="#将-map-用作-set" class="header-anchor">#</a> 将 map 用作 set</h3> <p>Set 这种集合与数组类似，但元素不会重复，Go 语言里没有提供 set 集合。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> temperatures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span>
		<span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33.0</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	set <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
    <span class="token comment">// 将温度值作为key</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> temperatures <span class="token punctuation">{</span>
		set<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> set<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;set member&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span>
    <span class="token comment">// 创建切片</span>
	unique <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 将数据添加到切片中</span>
	<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> set <span class="token punctuation">{</span>
		unique <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>unique<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// 排序</span>
	sort<span class="token punctuation">.</span><span class="token function">Float64s</span><span class="token punctuation">(</span>unique<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unique<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="struct结构体"><a href="#struct结构体" class="header-anchor">#</a> struct结构体</h2> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> curiosity <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		lat  <span class="token builtin">float64</span>
		long <span class="token builtin">float64</span>
	<span class="token punctuation">}</span>

	curiosity<span class="token punctuation">.</span>lat <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4.5895</span>
	curiosity<span class="token punctuation">.</span>long <span class="token operator">=</span> <span class="token number">137.4417</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> curiosity<span class="token punctuation">.</span>long<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>通过类型复用结构体以及结构体初始化</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span>
<span class="token punctuation">}</span>
<span class="token comment">// 复合字面值初始化</span>
opportunity <span class="token operator">:=</span> location<span class="token punctuation">{</span>lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.9462</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">354.4734</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>opportunity<span class="token punctuation">)</span>
<span class="token comment">// long将会变成对应属性的0值</span>
insight <span class="token operator">:=</span> location<span class="token punctuation">{</span>lat<span class="token punctuation">:</span> <span class="token number">4.5</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>insight<span class="token punctuation">)</span>
<span class="token comment">// 按顺序进行初始化</span>
curiosity <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> curiosity<span class="token punctuation">)</span>
<span class="token comment">// +v这样可以输出前面的label</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> curiosity<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>struct的复制是复制一个新的副本，对其修改不会影响之前的值</li></ul> <h3 id="由结构体构成slice"><a href="#由结构体构成slice" class="header-anchor">#</a> 由结构体构成slice</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	name <span class="token builtin">string</span>
	lat  <span class="token builtin">float64</span>
	long <span class="token builtin">float64</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建切片</span>
locations <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>location<span class="token punctuation">{</span>
	<span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Bradbury Landing&quot;</span><span class="token punctuation">,</span> lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">137.4417</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Columbia Memorial Station&quot;</span><span class="token punctuation">,</span> lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">14.5684</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">175.472636</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Challenger Memorial Station&quot;</span><span class="token punctuation">,</span> lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.9462</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">354.4734</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="将结构体编码成json"><a href="#将结构体编码成json" class="header-anchor">#</a> 将结构体编码成json</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;encoding/json&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">// 必须是大写，不然编码后会显示为空</span>
		Lat<span class="token punctuation">,</span> Long <span class="token builtin">float64</span>
	<span class="token punctuation">}</span>

	curiosity <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span>
	<span class="token comment">// 使用json包的 Marshal 函数将struct转成json</span>
	bytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">)</span>
	<span class="token function">exitOnError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// exitOnError prints any errors and exits.</span>
<span class="token keyword">func</span> <span class="token function">exitOnError</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>Go 语言中的 json 包要求 struct 中的字段必须以大写字母开头，类似 CamelCase 驼峰型命名规范。但有时候我们需要 snake_case 蛇形命名规范，那可以为字段注明标签，使得 json 包在进行编码的时候能够按照标签里的样式修改字段名。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Lat  <span class="token builtin">float64</span> <span class="token string">`json:&quot;latitude&quot;`</span>
	Long <span class="token builtin">float64</span> <span class="token string">`json:&quot;longitude&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样输出时的label就会变成我们设置的latitude和longitude。</p> <h2 id="组合和转发"><a href="#组合和转发" class="header-anchor">#</a> 组合和转发</h2> <h3 id="组合"><a href="#组合" class="header-anchor">#</a> 组合</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> report <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	sol         <span class="token builtin">int</span>
	temperature temperature
	location    location
<span class="token punctuation">}</span>

<span class="token keyword">type</span> temperature <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	high<span class="token punctuation">,</span> low celsius
<span class="token punctuation">}</span>

<span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> celsius <span class="token builtin">float64</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="转发方法"><a href="#转发方法" class="header-anchor">#</a> 转发方法</h3> <p>Go 可以通过 struct 嵌入 来实现方法的转发。在 struct 中只给定字段类型，不给定字段名即可。
在 struct 中，可以转发任意类型。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> report <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	sol <span class="token builtin">int</span>
	temperature
	location
<span class="token punctuation">}</span>

<span class="token keyword">type</span> temperature <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	high<span class="token punctuation">,</span> low celsius
<span class="token punctuation">}</span>

<span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> celsius <span class="token builtin">float64</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t temperature<span class="token punctuation">)</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span> celsius <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>high <span class="token operator">+</span> t<span class="token punctuation">.</span>low<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	report <span class="token operator">:=</span> report<span class="token punctuation">{</span>
		sol<span class="token punctuation">:</span>         <span class="token number">15</span><span class="token punctuation">,</span>
		location<span class="token punctuation">:</span>    location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		temperature<span class="token punctuation">:</span> temperature<span class="token punctuation">{</span>high<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> low<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">78.0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 转发之后，report可以直接调用average方法</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;average %vº C\n&quot;</span><span class="token punctuation">,</span> report<span class="token punctuation">.</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 虽然没有设置字段名，但是go语言会自动帮我们生成一个和类型名一样的字段名</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;average %vº C\n&quot;</span><span class="token punctuation">,</span> report<span class="token punctuation">.</span>temperature<span class="token punctuation">.</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%vº C\n&quot;</span><span class="token punctuation">,</span> report<span class="token punctuation">.</span>high<span class="token punctuation">)</span>
	report<span class="token punctuation">.</span>high <span class="token operator">=</span> <span class="token number">32</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%vº C\n&quot;</span><span class="token punctuation">,</span> report<span class="token punctuation">.</span>temperature<span class="token punctuation">.</span>high<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><code>average</code>是temperature类型的方法，但是通过嵌入，可以实现方法的转发，级report可以直接调用average方法。</p> <h2 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h2> <p>接口是实现方和调用方约定好的一种合作协议。当接口名的首字母和方法名的首字母大写的时候，表示该方法是公开的。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Tank <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="指针"><a href="#指针" class="header-anchor">#</a> 指针</h2> <p>C 语言中的内存地址可以通过例如 address++ 这样的指针运算进行操作，但是在 Go 里面不允许这种不安全操作。</p> <ul><li>将 * 放在类型前面表示声明指针类型</li> <li>将 * 放在变量前面表示解引用操作</li> <li>两个指针变量持有相同的内存地址，那么它们就是相等的</li></ul> <h3 id="指向结构体的指针"><a href="#指向结构体的指针" class="header-anchor">#</a> 指向结构体的指针</h3> <p>与字符串和数值不一样，复合字面量的前面可以放置 &amp;</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		name<span class="token punctuation">,</span> superpower <span class="token builtin">string</span>
		age              <span class="token builtin">int</span>
	<span class="token punctuation">}</span>

	timmy <span class="token operator">:=</span> <span class="token operator">&amp;</span>person<span class="token punctuation">{</span>
		name<span class="token punctuation">:</span> <span class="token string">&quot;Timothy&quot;</span><span class="token punctuation">,</span>
		age<span class="token punctuation">:</span>  <span class="token number">10</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	timmy<span class="token punctuation">.</span>superpower <span class="token operator">=</span> <span class="token string">&quot;flying&quot;</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> timmy<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="指向数组的指针"><a href="#指向数组的指针" class="header-anchor">#</a> 指向数组的指针</h3> <ul><li>和结构体一样，可以把 &amp; 放在数组的复合字面值前面来创建指向数组的指针。</li> <li>数组在执行索引或切片操作时会自动解引用。没有必要写 (*superpower)[0] 这种形式。</li> <li>与 C 语言不一样，Go 里面数组和指针是两种完全独立的类型。</li> <li>Slice 和 map 的复合字面值前面也可以放置 &amp; 操作符，但是 Go 并没有为它们提供自动解引用的功能。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>superpowers <span class="token operator">:=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;flight&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;invisibility&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;super strength&quot;</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>superpowers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>superpowers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="实现修改"><a href="#实现修改" class="header-anchor">#</a> 实现修改</h3> <ul><li>Go 语言的函数和方法都是按值传递参数的，这意味着函数总是操作于被传递参数的副本。</li> <li>当指针被传递到函数时，函数将接收传入的内存地址的副本。之后函数可以通过解引用内存地址来修改指针指向的值。</li> <li>方法的接收者和方法的参数在处理指针方面是很相似的。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    name <span class="token builtin">string</span>
    age <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span> <span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span>age<span class="token operator">++</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">birthday</span><span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span>age<span class="token operator">++</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Go 语言在变量通过点标记法进行调用的时候，自动使用 &amp; 取得变量的内存地址。</p> <h3 id="内部指针"><a href="#内部指针" class="header-anchor">#</a> 内部指针</h3> <ul><li>Go 语言提供了内部指针这种特性。它用于确定结构体中指定字段的内存地址。</li> <li>&amp; 操作符不仅可以获得结构体的内存地址，还可以获得结构体中指定字段的内存地址。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> stats <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	level             <span class="token builtin">int</span>
	endurance<span class="token punctuation">,</span> health <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">levelUp</span><span class="token punctuation">(</span>s <span class="token operator">*</span>stats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	s<span class="token punctuation">.</span>level<span class="token operator">++</span>
	s<span class="token punctuation">.</span>endurance <span class="token operator">=</span> <span class="token number">42</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>level<span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>health <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>endurance
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span> character <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		name  <span class="token builtin">string</span>
		stats stats
	<span class="token punctuation">}</span>

	player <span class="token operator">:=</span> character<span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Matthias&quot;</span><span class="token punctuation">}</span>
	<span class="token function">levelUp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>player<span class="token punctuation">.</span>stats<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>stats<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="修改数组"><a href="#修改数组" class="header-anchor">#</a> 修改数组</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">reset</span><span class="token punctuation">(</span>board <span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'r'</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> board <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">rune</span>
	<span class="token function">reset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>board<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c&quot;</span><span class="token punctuation">,</span> board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="隐式的指针"><a href="#隐式的指针" class="header-anchor">#</a> 隐式的指针</h3> <ul><li>Go 语言里一些内置的集合类型就在暗中使用指针。</li> <li>map 在被赋值或者呗作为参数传递的时候不会被复制。map 就是一种隐式指针。</li> <li>map 的键和值都可以是指针类型。</li> <li>需要将指针指向 map 的情况并不多见。</li></ul> <h3 id="slice-指向数组"><a href="#slice-指向数组" class="header-anchor">#</a> slice 指向数组</h3> <p>实际上 slice 在指向数组元素的时候也使用了指针。每个 slice 内部都会被表示为一个包含 3 个元素的结构，它们分别指向：</p> <ul><li>数组的指针</li> <li>slice 的容量</li> <li>slice 的长度</li></ul> <p>当 slice 被直接传递至函数或方法时，slice 的内部指针就可以对底层数据进行修改。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">reclassify</span><span class="token punctuation">(</span>planets <span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">*</span>planets <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>planets<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
		<span class="token string">&quot;Mercury&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Saturn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uranus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Neptune&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token function">reclassify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>planets<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="指针和接口"><a href="#指针和接口" class="header-anchor">#</a> 指针和接口</h3> <ul><li><p>本例中，无论 martian 还是指向 martian 的指针，都可以满足 talker 接口。</p></li> <li><p>如果方法使用的是指针接收者，那么情况会有所不同。</p></li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> stats <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	level             <span class="token builtin">int</span>
	endurance<span class="token punctuation">,</span> health <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">levelUp</span><span class="token punctuation">(</span>s <span class="token operator">*</span>stats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	s<span class="token punctuation">.</span>level<span class="token operator">++</span>
	s<span class="token punctuation">.</span>endurance <span class="token operator">=</span> <span class="token number">42</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>level<span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>health <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>endurance
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span> character <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		name  <span class="token builtin">string</span>
		stats stats
	<span class="token punctuation">}</span>

	player <span class="token operator">:=</span> character<span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Matthias&quot;</span><span class="token punctuation">}</span>
	<span class="token function">levelUp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>player<span class="token punctuation">.</span>stats<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>stats<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h2> <p>Go 语言允许函数和方法同时返回多个值，按照惯例，函数在返回错误时，最后边的返回值应用来表示错误。调用函数后，应立即检查是否发生错误。如果没有错误发生，那么返回的错误值为 nil。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;io/ioutil&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	files<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> file <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="defer"><a href="#defer" class="header-anchor">#</a> defer</h3> <ul><li>使用 defer 关键字，Go 可以确保所有 deferred 的动作可以在函数返回前执行。</li> <li>可以 defer 任意的函数和方法。</li> <li>defer 并不是专门做错误处理的。</li> <li>defer 可以消除必须时刻惦记执行资源释放的负担</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">proverbs</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Errors are values.&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>

	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Don’t just check errors, handle them gracefully.&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="goroutine"><a href="#goroutine" class="header-anchor">#</a> goroutine</h2> <p>在 Go 中，独立的任务叫做 goroutine。虽然 goroutine 与其它语言中的协程、进程、线程都有相似之处，但 goroutine 和它们并不完全相同。Goroutine 创建效率非常高，Go 能直截了当的协同多个并发（concurrent）操作。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;... snore ...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>向 goroutine 传递参数就跟向函数传递参数一样，参数都是按值传递的（传入的是副本）</li></ul> <div class="language-GO line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;... snore ... &quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="channel"><a href="#channel" class="header-anchor">#</a> channel</h2> <ul><li>通道可以在多个goroutine之间安全传值。</li> <li>通过可以用作变量、函数参数、结构体字段...</li> <li>创建通道使用<code>make</code>函数，并指定其传输数据的类型。</li></ul> <h3 id="通过channel发送、接收"><a href="#通过channel发送、接收" class="header-anchor">#</a> 通过channel发送、接收</h3> <p>使用左箭头操作符 <code>&lt;-</code> 向通道发送值 或 从通道接收值</p> <ul><li><p>向通道发送值：c &lt;- 99</p></li> <li><p>从通道接收值：r := &lt;- c</p></li> <li><p>发送操作会等待直到另一个 goroutine 尝试对该通道进行接收操作为止。</p></li> <li><p>执行发送操作的 goroutine 在等待期间将无法执行其它操作</p></li> <li><p>未在等待通道操作的 goroutine 让然可以继续自由的运行</p></li></ul> <p>执行接收操作的 goroutine 将等待直到另一个 goroutine 尝试向该通道进行发送操作为止。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		gopherID <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gopher &quot;</span><span class="token punctuation">,</span> gopherID<span class="token punctuation">,</span> <span class="token string">&quot; has finshed...&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot; ... &quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	c <span class="token operator">&lt;-</span> id
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="使用-select-处理多个通道"><a href="#使用-select-处理多个通道" class="header-anchor">#</a> 使用 select 处理多个通道</h3> <p>select 和 switch 有点像。该语句包含的每个 case 都持有一个通道，用来发送或接收数据。select 会等待直到某个 case 分支的操作就绪，然后就会执行该 case 分支。</p> <p>**注意：**即使已经停止等待 goroutine，但只要 main 函数还没返回，仍在运行的 goroutine 将会继续占用内存。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
  <span class="token comment">//time.After 函数，返回一个通道，该通道在指定时间后会接收到一个值</span>
  <span class="token comment">//（发送该值的 goroutine 是 Go 运行时的一部分）</span>
	timeout <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">select</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> gopherID <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c<span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gopher &quot;</span><span class="token punctuation">,</span> gopherID<span class="token punctuation">,</span> <span class="token string">&quot; has finished sleeping&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>timeout<span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;my patience ran out&quot;</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
	c <span class="token operator">&lt;-</span> id
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="阻塞和死锁"><a href="#阻塞和死锁" class="header-anchor">#</a> 阻塞和死锁</h3> <ul><li>当 goroutine 在等待通道的发送或接收时，我们就说它被阻塞了。</li> <li>除了 goroutine 本身占用少量的内存外，被阻塞的 goroutine 并不消耗任何其它资源。</li> <li>当一个或多个 goroutine 因为某些永远无法发生的事情被阻塞时，我们称这种情况为死锁。而出现死锁的程序通常会崩溃或挂起。</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// 流水线实例</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c0 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">,</span> c1<span class="token punctuation">)</span>
	<span class="token function">printGopher</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a bad apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goodbye all&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
		downstream <span class="token operator">&lt;-</span> v
	<span class="token punctuation">}</span>
	downstream <span class="token operator">&lt;-</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>upstream<span class="token punctuation">,</span> downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		item <span class="token operator">:=</span> <span class="token operator">&lt;-</span>upstream
		<span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
			downstream <span class="token operator">&lt;-</span> <span class="token string">&quot;&quot;</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;bad&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			downstream <span class="token operator">&lt;-</span> item
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">printGopher</span><span class="token punctuation">(</span>upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>upstream
		<span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>Go 允许在没有值可供发送的情况下通过 close 函数关闭通道。通道被关闭后无法写入任何值，如果尝试写入将引发 panic。尝试读取被关闭的通道会获得与通道类型对应的零值。</p> <p><strong>注意：</strong> 如果循环里读取一个已关闭的通道，并没检查通道是否关闭，那么该循环可能会一直运转下去，耗费大量 CPU 时间。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> c <span class="token comment">// 可以得知通道是否被关</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>对流水线代码进行改造</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c0 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">,</span> c1<span class="token punctuation">)</span>
	<span class="token function">printGopher</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a bad apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goodbye all&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
		downstream <span class="token operator">&lt;-</span> v
	<span class="token punctuation">}</span>
	<span class="token function">close</span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>upstream<span class="token punctuation">,</span> downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		item<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>upstream
		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
			<span class="token function">close</span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;bad&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			downstream <span class="token operator">&lt;-</span> item
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">printGopher</span><span class="token punctuation">(</span>upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> upstream <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>从通道里面读取值，直到它关闭为止。也可以使用 range 关键字达到该目的。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c0 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">,</span> c1<span class="token punctuation">)</span>
	<span class="token function">printGopher</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a bad apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goodbye all&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
		downstream <span class="token operator">&lt;-</span> v
	<span class="token punctuation">}</span>
	<span class="token function">close</span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>upstream<span class="token punctuation">,</span> downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> item <span class="token operator">:=</span> <span class="token keyword">range</span> upstream <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;bad&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			downstream <span class="token operator">&lt;-</span> item
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">close</span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">printGopher</span><span class="token punctuation">(</span>upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> upstream <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2021/6/10 下午3:46:34</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#设置代理" class="sidebar-link reco-side-设置代理" data-v-70334359>设置代理</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#分支和循环" class="sidebar-link reco-side-分支和循环" data-v-70334359>分支和循环</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#实数" class="sidebar-link reco-side-实数" data-v-70334359>实数</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#整数" class="sidebar-link reco-side-整数" data-v-70334359>整数</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#big包" class="sidebar-link reco-side-big包" data-v-70334359>big包</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#较大值的常量" class="sidebar-link reco-side-较大值的常量" data-v-70334359>较大值的常量</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#字符和字符串" class="sidebar-link reco-side-字符和字符串" data-v-70334359>字符和字符串</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#rune" class="sidebar-link reco-side-rune" data-v-70334359>rune</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#字符" class="sidebar-link reco-side-字符" data-v-70334359>字符</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#字符串" class="sidebar-link reco-side-字符串" data-v-70334359>字符串</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#类型转换" class="sidebar-link reco-side-类型转换" data-v-70334359>类型转换</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#函数" class="sidebar-link reco-side-函数" data-v-70334359>函数</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#方法" class="sidebar-link reco-side-方法" data-v-70334359>方法</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#一等函数" class="sidebar-link reco-side-一等函数" data-v-70334359>一等函数</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#闭包和匿名函数" class="sidebar-link reco-side-闭包和匿名函数" data-v-70334359>闭包和匿名函数</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#数组" class="sidebar-link reco-side-数组" data-v-70334359>数组</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#数组复制" class="sidebar-link reco-side-数组复制" data-v-70334359>数组复制</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#切片" class="sidebar-link reco-side-切片" data-v-70334359>切片</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#map" class="sidebar-link reco-side-map" data-v-70334359>map</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#使用-make-函数对-map-进行预分配" class="sidebar-link reco-side-使用-make-函数对-map-进行预分配" data-v-70334359>使用 make 函数对 map 进行预分配</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#使用-map-和-slice-实现数据分组" class="sidebar-link reco-side-使用-map-和-slice-实现数据分组" data-v-70334359>使用 map 和 slice 实现数据分组</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#将-map-用作-set" class="sidebar-link reco-side-将-map-用作-set" data-v-70334359>将 map 用作 set</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#struct结构体" class="sidebar-link reco-side-struct结构体" data-v-70334359>struct结构体</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#由结构体构成slice" class="sidebar-link reco-side-由结构体构成slice" data-v-70334359>由结构体构成slice</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#将结构体编码成json" class="sidebar-link reco-side-将结构体编码成json" data-v-70334359>将结构体编码成json</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#组合和转发" class="sidebar-link reco-side-组合和转发" data-v-70334359>组合和转发</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#组合" class="sidebar-link reco-side-组合" data-v-70334359>组合</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#转发方法" class="sidebar-link reco-side-转发方法" data-v-70334359>转发方法</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#接口" class="sidebar-link reco-side-接口" data-v-70334359>接口</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#指针" class="sidebar-link reco-side-指针" data-v-70334359>指针</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#指向结构体的指针" class="sidebar-link reco-side-指向结构体的指针" data-v-70334359>指向结构体的指针</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#指向数组的指针" class="sidebar-link reco-side-指向数组的指针" data-v-70334359>指向数组的指针</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#实现修改" class="sidebar-link reco-side-实现修改" data-v-70334359>实现修改</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#内部指针" class="sidebar-link reco-side-内部指针" data-v-70334359>内部指针</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#修改数组" class="sidebar-link reco-side-修改数组" data-v-70334359>修改数组</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#隐式的指针" class="sidebar-link reco-side-隐式的指针" data-v-70334359>隐式的指针</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#slice-指向数组" class="sidebar-link reco-side-slice-指向数组" data-v-70334359>slice 指向数组</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#指针和接口" class="sidebar-link reco-side-指针和接口" data-v-70334359>指针和接口</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#错误处理" class="sidebar-link reco-side-错误处理" data-v-70334359>错误处理</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#defer" class="sidebar-link reco-side-defer" data-v-70334359>defer</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#goroutine" class="sidebar-link reco-side-goroutine" data-v-70334359>goroutine</a></li><li class="level-2" data-v-70334359><a href="/blogs/backend/go.html#channel" class="sidebar-link reco-side-channel" data-v-70334359>channel</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#通过channel发送、接收" class="sidebar-link reco-side-通过channel发送、接收" data-v-70334359>通过channel发送、接收</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#使用-select-处理多个通道" class="sidebar-link reco-side-使用-select-处理多个通道" data-v-70334359>使用 select 处理多个通道</a></li><li class="level-3" data-v-70334359><a href="/blogs/backend/go.html#阻塞和死锁" class="sidebar-link reco-side-阻塞和死锁" data-v-70334359>阻塞和死锁</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.48ae9a92.js" defer></script><script src="/assets/js/3.4643d9f1.js" defer></script><script src="/assets/js/1.edbbee7e.js" defer></script><script src="/assets/js/15.2267be98.js" defer></script>
  </body>
</html>
